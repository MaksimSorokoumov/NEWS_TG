flowchart TD
  %% Источники данных
  A[Telegram Чаты] -->|API| B[Сбор данных]
  DSource["Другие источники: Twitter, Reddit, форумы"] --> B

  %% Хранение данных
  subgraph Хранение["JSON База данных"]
    JSON1[Сырые данные]
    JSON2[Обработанные данные]
    JSON3[Аналитические результаты]
    JSON4[Метаданные]
    BACKUP[Резервные копии]
  end

  %% Предобработка
  subgraph Предобработка
    B --> C[Очистка и токенизация]
    C --> D[Структурирование данных]
    B --> JSON1
    D --> JSON2
  end

  %% Мультимедиа анализ
  subgraph Мультимедиа
    B --> MM1[Анализ изображений]
    B --> MM2[Анализ документов]
  end

  %% Расширенный анализ
  subgraph Анализ["Расширенный анализ"]
    JSON2 --> E1[NLP анализ]
    JSON2 --> E2[Анализ метрик]
    JSON2 --> E3[Социальный анализ]
    
    %% NLP процессы с новыми модулями
    subgraph NLP["NLP процессы"]
      E1 --> F1[Анализ тональности]
      E1 --> F2[Извлечение задач и сроков]
      E1 --> F3[Тематическое моделирование]
      E1 --> F4[Речевые паттерны]
      F1 --- F7[Аспектный сентимент-анализ]
      E1 --> F5[Распознавание намерений]
      E1 --> F6[Извлечение сущностей - NER]
    end

    %% Дополнительный модуль контекстного прогнозирования
    E2 --> CTX[Контекстное прогнозирование - DoubleML, внешние данные]
    
    %% Метрики и валидация
    subgraph Метрики["Метрики и валидация"]
      E2 --> G1[Временные ряды]
      E2 --> G2[KPI проектов]
      E2 --> G3[Статистика активности]
      E2 --> G4[Детекция аномалий]
      E2 --> G5[Валидация предсказаний]
    end

    %% Социальный анализ с расширенной оценкой влияния
    subgraph Соц_анализ["Социальный граф"]
      E3 --> H1[Кластеризация участников]
      E3 --> H2[Анализ взаимодействий]
      E3 --> H3[Выявление влияния - PageRank, Centrality]
    end
  end

  %% Ensemble методы с дополнительными моделями
  subgraph ML["Ensemble методы"]
    F1 & F2 & F3 & F4 & F5 & F6 & F7 & G1 & G2 & G3 & G4 & H1 & H2 & H3 --> ML1[Агрегация моделей]
    AdditionalModels[Дополнительные модели - Temporal Fusion Transformer, Graph Neural Networks]
    AdditionalModels --- ML1
    ML1 --> ML2[Взвешенное голосование]
    ML2 --> ML3[Финальный прогноз]
  end

  %% Модуль объяснимости
  subgraph Объяснимость["Объяснимость"]
    ML3 --> EXPL1[Визуализация уверенности - Confidence Score]
    ML3 --> EXPL2[Объяснение решений - SHAP, LIME]
  end

  %% Прогнозирование рисков
  subgraph Риски["Прогнозирование рисков"]
    ML3 --> RISK1[Оценка рисков - задержки, снижение активности]
    RISK1 --> RISK2[Сценарии развития событий - с вероятностями]
  end

  %% Агрегация результатов
  subgraph Результаты
    EXPL1 & EXPL2 & RISK2 --> I[Агрегация результатов]
    I --> JSON3
    I --> J1[Интерактивные дашборды]
    I --> J2[Умные уведомления]
    I --> J3[Автогенерация отчётов]
  end

  %% Модуль интерактивности
  subgraph Интерактивность["Интерактивность"]
    J1 & J2 & J3 --> INT_Q[Диалоговый режим с уточняющими вопросами - например: Вы имели в виду сроки проекта X или Y?]
    INT_Q --> DYN[Динамические пошаговые ответы - свободная форма запроса]
  end

  %% Улучшение работы с векторными базами данных
  subgraph Векторная_БД["Векторная база данных"]
    DYN --> VF1[Предварительная фильтрация запросов]
    VF1 --> VF2[Мульти-эмбеддинги - текст, изображения, временные ряды]
    VF2 --> INT1[Обогащённый контекст для персонализации]
  end

  %% Персонализация
  subgraph Персонализация["Персонализация"]
    INT1 --> PERS1[Динамические пользовательские профили - векторная БД]
    PERS1 --> PERS2[Адаптивные сценарии ответов - учёт роли, стиля, истории]
  end

  %% Интеграции с внешними сервисами
  subgraph Интеграции
    J1 & J2 & J3 & PERS2 --> INT2[Календари и голосовой интерфейс]
  end

  %% A/B тестирование и оптимизация
  subgraph AB["A/B тестирование"]
    K[Система принятия решений] --> AB1[Тест А]
    K --> AB2[Тест B]
    AB1 & AB2 --> AB3[Анализ результатов]
  end

  AB3 --> L[Оптимизация процессов]

  %% Резервное копирование и метаданные
  JSON1 & JSON2 & JSON3 & JSON4 --> BACKUP
  B & C & D & E1 & E2 & E3 --> JSON4